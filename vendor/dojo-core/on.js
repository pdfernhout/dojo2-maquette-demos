(function (factory) {
    if (typeof module === 'object' && typeof module.exports === 'object') {
        var v = factory(require, exports); if (v !== undefined) module.exports = v;
    }
    else if (typeof define === 'function' && define.amd) {
        define(["require", "exports", './lang'], factory);
    }
})(function (require, exports) {
    var lang_1 = require('./lang');
    function emit(target, event) {
        if (target.dispatchEvent &&
            ((target.ownerDocument && target.ownerDocument.createEvent) ||
                (target.document && target.document.createEvent) ||
                target.createEvent) /* matches document */) {
            var nativeEvent = (target.ownerDocument || target.document || target).createEvent('HTMLEvents');
            nativeEvent.initEvent(event.type, Boolean(event.bubbles), Boolean(event.cancelable));
            for (var key in event) {
                if (!(key in nativeEvent)) {
                    nativeEvent[key] = event[key];
                }
            }
            return target.dispatchEvent(nativeEvent);
        }
        if (target.emit) {
            if (target.removeListener) {
                target.emit(event.type, event);
                return false;
            }
            else if (target.on) {
                target.emit(event);
                return false;
            }
        }
        throw new Error('Target must be an event emitter');
    }
    exports.emit = emit;
    function on(target, type, listener, capture) {
        if (Array.isArray(type)) {
            var handles = type.map(function (type) {
                return on(target, type, listener, capture);
            });
            return lang_1.createCompositeHandle.apply(void 0, handles);
        }
        var callback = function () {
            listener.apply(this, arguments);
        };
        // DOM EventTarget
        if (target.addEventListener && target.removeEventListener) {
            target.addEventListener(type, callback, capture);
            return lang_1.createHandle(function () {
                target.removeEventListener(type, callback, capture);
            });
        }
        if (target.on) {
            // EventEmitter
            if (target.removeListener) {
                target.on(type, callback);
                return lang_1.createHandle(function () {
                    target.removeListener(type, callback);
                });
            }
            else if (target.emit) {
                return target.on(type, listener);
            }
        }
        throw new TypeError('Unknown event emitter object');
    }
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.default = on;
    function once(target, type, listener, capture) {
        var handle = on(target, type, function () {
            handle.destroy();
            return listener.apply(this, arguments);
        }, capture);
        return handle;
    }
    exports.once = once;
    function pausable(target, type, listener, capture) {
        var paused;
        var handle = on(target, type, function () {
            if (!paused) {
                return listener.apply(this, arguments);
            }
        }, capture);
        handle.pause = function () {
            paused = true;
        };
        handle.resume = function () {
            paused = false;
        };
        return handle;
    }
    exports.pausable = pausable;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvb24udHMiXSwibmFtZXMiOlsiZW1pdCIsIm9uIiwib25jZSIsInBhdXNhYmxlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7OztJQUNBLHFCQUFvRCxRQUFRLENBQUMsQ0FBQTtJQXdCN0QsY0FBNEMsTUFBVyxFQUFFLEtBQXNCO1FBQzlFQSxFQUFFQSxDQUFDQSxDQUNGQSxNQUFNQSxDQUFDQSxhQUFhQTtZQUNuQkEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsYUFBYUEsSUFBSUEsTUFBTUEsQ0FBQ0EsYUFBYUEsQ0FBQ0EsV0FBV0EsQ0FBQ0E7Z0JBQzNEQSxDQUFDQSxNQUFNQSxDQUFDQSxRQUFRQSxJQUFJQSxNQUFNQSxDQUFDQSxRQUFRQSxDQUFDQSxXQUFXQSxDQUFDQTtnQkFDaERBLE1BQU1BLENBQUNBLFdBQVdBLENBQUNBLENBQUNBLHNCQUN0QkEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDRkEsSUFBTUEsV0FBV0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsYUFBYUEsSUFBSUEsTUFBTUEsQ0FBQ0EsUUFBUUEsSUFBSUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsV0FBV0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsQ0FBQ0E7WUFDbEdBLFdBQVdBLENBQUNBLFNBQVNBLENBQ3BCQSxLQUFLQSxDQUFDQSxJQUFJQSxFQUNWQSxPQUFPQSxDQUFtQkEsS0FBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsRUFDekNBLE9BQU9BLENBQW1CQSxLQUFNQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUM1Q0EsQ0FBQ0E7WUFFRkEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsSUFBSUEsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ3ZCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxHQUFHQSxJQUFJQSxXQUFXQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDM0JBLFdBQVdBLENBQUNBLEdBQUdB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QUFDQSxNQUFNQSxDQUFDQTtJQUNmQSxDQUFDQTtJQWxCZSxnQkFBUSxXQWtCdkIsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEhhbmRsZSwgRXZlbnRPYmplY3QgfSBmcm9tICcuL2ludGVyZmFjZXMnO1xuaW1wb3J0IHsgY3JlYXRlSGFuZGxlLCBjcmVhdGVDb21wb3NpdGVIYW5kbGUgfSBmcm9tICcuL2xhbmcnO1xuaW1wb3J0IEV2ZW50ZWQgZnJvbSAnLi9FdmVudGVkJztcblxuZXhwb3J0IGludGVyZmFjZSBFdmVudENhbGxiYWNrIHtcblx0KGV2ZW50OiBFdmVudE9iamVjdCk6IHZvaWQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRXZlbnRFbWl0dGVyIHtcblx0b24oZXZlbnQ6IHN0cmluZywgbGlzdGVuZXI6IEV2ZW50Q2FsbGJhY2spOiBFdmVudEVtaXR0ZXI7XG5cdHJlbW92ZUxpc3RlbmVyKGV2ZW50OiBzdHJpbmcsIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrKTogRXZlbnRFbWl0dGVyO1xufVxuXG5pbnRlcmZhY2UgRE9NRXZlbnRPYmplY3QgZXh0ZW5kcyBFdmVudE9iamVjdCB7XG5cdGJ1YmJsZXM6IGJvb2xlYW47XG5cdGNhbmNlbGFibGU6IGJvb2xlYW47XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSBub3JtYWxpemVkIG1lY2hhbmlzbSBmb3IgZGlzcGF0Y2hpbmcgZXZlbnRzIGZvciBldmVudCBlbWl0dGVycywgRXZlbnRlZCBvYmplY3RzLCBvciBET00gbm9kZXMuXG4gKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdG8gZW1pdCB0aGUgZXZlbnQgZnJvbVxuICogQHBhcmFtIGV2ZW50IFRoZSBldmVudCBvYmplY3QgdG8gZW1pdFxuICogQHJldHVybiBCb29sZWFuIGluZGljYXRpbmcgV2hldGhlciB0aGUgZXZlbnQgd2FzIGNhbmNlbGVkICh0aGlzIHdpbGwgYWx3YXlzIGJlIGZhbHNlIGZvciBldmVudCBlbWl0dGVycylcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVtaXQ8VCBleHRlbmRzIEV2ZW50T2JqZWN0Pih0YXJnZXQ6IEV2ZW50ZWQgfCBFdmVudFRhcmdldCB8IEV2ZW50RW1pdHRlciwgZXZlbnQ6IFQgfCBFdmVudE9iamVjdCk6IGJvb2xlYW47XG5leHBvcnQgZnVuY3Rpb24gZW1pdDxUIGV4dGVuZHMgRXZlbnRPYmplY3Q+KHRhcmdldDogYW55LCBldmVudDogVCB8IEV2ZW50T2JqZWN0KTogYm9vbGVhbiB7XG5cdGlmIChcblx0XHR0YXJnZXQuZGlzcGF0Y2hFdmVudCAmJiAvKiBpbmNsdWRlcyB3aW5kb3cgYW5kIGRvY3VtZW50ICovXG5cdFx0XHQoKHRhcmdldC5vd25lckRvY3VtZW50ICYmIHRhcmdldC5vd25lckRvY3VtZW50LmNyZWF0ZUV2ZW50KSB8fCAvKiBtYXRjaGVzIG5vZGVzICovXG5cdFx0XHQodGFyZ2V0LmRvY3VtZW50ICYmIHRhcmdldC5kb2N1bWVudC5jcmVhdGVFdmVudCkgfHwgLyogbWF0Y2hlcyB3aW5kb3cgKi9cblx0XHRcdHRhcmdldC5jcmVhdGVFdmVudCkgLyogbWF0Y2hlcyBkb2N1bWVudCAqL1xuXHQpIHtcblx0XHRjb25zdCBuYXRpdmVFdmVudCA9ICh0YXJnZXQub3duZXJEb2N1bWVudCB8fCB0YXJnZXQuZG9jdW1lbnQgfHwgdGFyZ2V0KS5jcmVhdGVFdmVudCgnSFRNTEV2ZW50cycpO1xuXHRcdG5hdGl2ZUV2ZW50LmluaXRFdmVudChcblx0XHRcdGV2ZW50LnR5cGUsXG5cdFx0XHRCb29sZWFuKCg8RE9NRXZlbnRPYmplY3Q+IGV2ZW50KS5idWJibGVzKSxcblx0XHRcdEJvb2xlYW4oKDxET01FdmVudE9iamVjdD4gZXZlbnQpLmNhbmNlbGFibGUpXG5cdFx0KTtcblxuXHRcdGZvciAobGV0IGtleSBpbiBldmVudCkge1xuXHRcdFx0aWYgKCEoa2V5IGluIG5hdGl2ZUV2ZW50KSkge1xuXHRcdFx0XHRuYXRpdmVFdmVudFtrZXldID0gKDxhbnk+IGV2ZW50KVtrZXldO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiB0YXJnZXQuZGlzcGF0Y2hFdmVudChuYXRpdmVFdmVudCk7XG5cdH1cblxuXHRpZiAodGFyZ2V0LmVtaXQpIHtcblx0XHRpZiAodGFyZ2V0LnJlbW92ZUxpc3RlbmVyKSB7XG5cdFx0XHR0YXJnZXQuZW1pdChldmVudC50eXBlLCBldmVudCk7XG5cdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKHRhcmdldC5vbikge1xuXHRcdFx0dGFyZ2V0LmVtaXQoZXZlbnQpO1xuXHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdH1cblx0fVxuXG5cdHRocm93IG5ldyBFcnJvcignVGFyZ2V0IG11c3QgYmUgYW4gZXZlbnQgZW1pdHRlcicpO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGEgbm9ybWFsaXplZCBtZWNoYW5pc20gZm9yIGxpc3RlbmluZyB0byBldmVudHMgZnJvbSBldmVudCBlbWl0dGVycywgRXZlbnRlZCBvYmplY3RzLCBvciBET00gbm9kZXMuXG4gKiBAcGFyYW0gdGFyZ2V0IFRhcmdldCB0byBsaXN0ZW4gZm9yIGV2ZW50IG9uXG4gKiBAcGFyYW0gdHlwZSBFdmVudCBldmVudCB0eXBlKHMpIHRvIGxpc3RlbiBmb3I7IG1heSBhIHN0cmluZyBvciBhbiBhcnJheSBvZiBzdHJpbmdzXG4gKiBAcGFyYW0gbGlzdGVuZXIgQ2FsbGJhY2sgdG8gaGFuZGxlIHRoZSBldmVudCB3aGVuIGl0IGZpcmVzXG4gKiBAcGFyYW0gY2FwdHVyZSBXaGV0aGVyIHRoZSBsaXN0ZW5lciBzaG91bGQgYmUgcmVnaXN0ZXJlZCBpbiB0aGUgY2FwdHVyZSBwaGFzZSAoRE9NIGV2ZW50cyBvbmx5KVxuICogQHJldHVybiBBIGhhbmRsZSB3aGljaCB3aWxsIHJlbW92ZSB0aGUgbGlzdGVuZXIgd2hlbiBkZXN0cm95IGlzIGNhbGxlZFxuICovXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBvbih0YXJnZXQ6IEV2ZW50VGFyZ2V0LCB0eXBlOiBzdHJpbmcgfCBzdHJpbmdbXSwgbGlzdGVuZXI6IEV2ZW50Q2FsbGJhY2ssIGNhcHR1cmU/OiBib29sZWFuKTogSGFuZGxlO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gb24odGFyZ2V0OiBFdmVudEVtaXR0ZXIgfCBFdmVudGVkLCB0eXBlOiBzdHJpbmcgfCBzdHJpbmdbXSwgbGlzdGVuZXI6IEV2ZW50Q2FsbGJhY2spOiBIYW5kbGU7XG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBvbih0YXJnZXQ6IGFueSwgdHlwZTogYW55LCBsaXN0ZW5lcjogYW55LCBjYXB0dXJlPzogYm9vbGVhbik6IEhhbmRsZSB7XG5cdGlmIChBcnJheS5pc0FycmF5KHR5cGUpKSB7XG5cdFx0bGV0IGhhbmRsZXM6IEhhbmRsZVtdID0gdHlwZS5tYXAoZnVuY3Rpb24gKHR5cGU6IHN0cmluZyk6IEhhbmRsZSB7XG5cdFx0XHRyZXR1cm4gb24odGFyZ2V0LCB0eXBlLCBsaXN0ZW5lciwgY2FwdHVyZSk7XG5cdFx0fSk7XG5cblx0XHRyZXR1cm4gY3JlYXRlQ29tcG9zaXRlSGFuZGxlKC4uLmhhbmRsZXMpO1xuXHR9XG5cblx0Y29uc3QgY2FsbGJhY2sgPSBmdW5jdGlvbiAoKSB7XG5cdFx0bGlzdGVuZXIuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0fTtcblxuXHQvLyBET00gRXZlbnRUYXJnZXRcblx0aWYgKHRhcmdldC5hZGRFdmVudExpc3RlbmVyICYmIHRhcmdldC5yZW1vdmVFdmVudExpc3RlbmVyKSB7XG5cdFx0dGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2ssIGNhcHR1cmUpO1xuXHRcdHJldHVybiBjcmVhdGVIYW5kbGUoZnVuY3Rpb24gKCkge1xuXHRcdFx0dGFyZ2V0LnJlbW92ZUV2ZW50TGlzdGVuZXIodHlwZSwgY2FsbGJhY2ssIGNhcHR1cmUpO1xuXHRcdH0pO1xuXHR9XG5cblx0aWYgKHRhcmdldC5vbikge1xuXHRcdC8vIEV2ZW50RW1pdHRlclxuXHRcdGlmICh0YXJnZXQucmVtb3ZlTGlzdGVuZXIpIHtcblx0XHRcdHRhcmdldC5vbih0eXBlLCBjYWxsYmFjayk7XG5cdFx0XHRyZXR1cm4gY3JlYXRlSGFuZGxlKGZ1bmN0aW9uICgpIHtcblx0XHRcdFx0dGFyZ2V0LnJlbW92ZUxpc3RlbmVyKHR5cGUsIGNhbGxiYWNrKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHQvLyBFdmVudGVkXG5cdFx0ZWxzZSBpZiAodGFyZ2V0LmVtaXQpIHtcblx0XHRcdHJldHVybiB0YXJnZXQub24odHlwZSwgbGlzdGVuZXIpO1xuXHRcdH1cblx0fVxuXG5cdHRocm93IG5ldyBUeXBlRXJyb3IoJ1Vua25vd24gZXZlbnQgZW1pdHRlciBvYmplY3QnKTtcbn1cblxuLyoqXG4gKiBQcm92aWRlcyBhIG1lY2hhbmlzbSBmb3IgbGlzdGVuaW5nIHRvIHRoZSBuZXh0IG9jY3VycmVuY2Ugb2YgYW4gZXZlbnQgZnJvbSBldmVudFxuICogZW1pdHRlcnMsIEV2ZW50ZWQgb2JqZWN0cywgb3IgRE9NIG5vZGVzLlxuICogQHBhcmFtIHRhcmdldCBUYXJnZXQgdG8gbGlzdGVuIGZvciBldmVudCBvblxuICogQHBhcmFtIHR5cGUgRXZlbnQgZXZlbnQgdHlwZShzKSB0byBsaXN0ZW4gZm9yOyBtYXkgYmUgYSBzdHJpbmcgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nc1xuICogQHBhcmFtIGxpc3RlbmVyIENhbGxiYWNrIHRvIGhhbmRsZSB0aGUgZXZlbnQgd2hlbiBpdCBmaXJlc1xuICogQHBhcmFtIGNhcHR1cmUgV2hldGhlciB0aGUgbGlzdGVuZXIgc2hvdWxkIGJlIHJlZ2lzdGVyZWQgaW4gdGhlIGNhcHR1cmUgcGhhc2UgKERPTSBldmVudHMgb25seSlcbiAqIEByZXR1cm4gQSBoYW5kbGUgd2hpY2ggd2lsbCByZW1vdmUgdGhlIGxpc3RlbmVyIHdoZW4gZGVzdHJveSBpcyBjYWxsZWRcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIG9uY2UodGFyZ2V0OiBFdmVudFRhcmdldCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrLCBjYXB0dXJlPzogYm9vbGVhbik6IEhhbmRsZTtcbmV4cG9ydCBmdW5jdGlvbiBvbmNlKHRhcmdldDogRXZlbnRFbWl0dGVyIHwgRXZlbnRlZCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrKTogSGFuZGxlO1xuZXhwb3J0IGZ1bmN0aW9uIG9uY2UodGFyZ2V0OiBhbnksIHR5cGU6IGFueSwgbGlzdGVuZXI6IGFueSwgY2FwdHVyZT86IGJvb2xlYW4pOiBIYW5kbGUge1xuXHRjb25zdCBoYW5kbGUgPSBvbih0YXJnZXQsIHR5cGUsIGZ1bmN0aW9uICgpIHtcblx0XHRoYW5kbGUuZGVzdHJveSgpO1xuXHRcdHJldHVybiBsaXN0ZW5lci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHR9LCBjYXB0dXJlKTtcblxuXHRyZXR1cm4gaGFuZGxlO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFBhdXNhYmxlSGFuZGxlIGV4dGVuZHMgSGFuZGxlIHtcblx0cGF1c2UoKTogdm9pZDtcblx0cmVzdW1lKCk6IHZvaWQ7XG59XG5cbi8qKlxuICogUHJvdmlkZXMgYSBtZWNoYW5pc20gZm9yIGNyZWF0aW5nIHBhdXNhYmxlIGxpc3RlbmVycyBmb3IgZXZlbnRzIGZyb20gZXZlbnQgZW1pdHRlcnMsIEV2ZW50ZWQgb2JqZWN0cywgb3IgRE9NIG5vZGVzLlxuICogQHBhcmFtIHRhcmdldCBUYXJnZXQgdG8gbGlzdGVuIGZvciBldmVudCBvblxuICogQHBhcmFtIHR5cGUgRXZlbnQgZXZlbnQgdHlwZShzKSB0byBsaXN0ZW4gZm9yOyBtYXkgYSBzdHJpbmcgb3IgYW4gYXJyYXkgb2Ygc3RyaW5nc1xuICogQHBhcmFtIGxpc3RlbmVyIENhbGxiYWNrIHRvIGhhbmRsZSB0aGUgZXZlbnQgd2hlbiBpdCBmaXJlc1xuICogQHBhcmFtIGNhcHR1cmUgV2hldGhlciB0aGUgbGlzdGVuZXIgc2hvdWxkIGJlIHJlZ2lzdGVyZWQgaW4gdGhlIGNhcHR1cmUgcGhhc2UgKERPTSBldmVudHMgb25seSlcbiAqIEByZXR1cm4gQSBoYW5kbGUgd2l0aCBhZGRpdGlvbmFsIHBhdXNlIGFuZCByZXN1bWUgbWV0aG9kczsgdGhlIGxpc3RlbmVyIHdpbGwgbmV2ZXIgZmlyZSB3aGVuIHBhdXNlZFxuICovXG5leHBvcnQgZnVuY3Rpb24gcGF1c2FibGUodGFyZ2V0OiBFdmVudFRhcmdldCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrLCBjYXB0dXJlPzogYm9vbGVhbik6IFBhdXNhYmxlSGFuZGxlO1xuZXhwb3J0IGZ1bmN0aW9uIHBhdXNhYmxlKHRhcmdldDogRXZlbnRFbWl0dGVyIHwgRXZlbnRlZCwgdHlwZTogc3RyaW5nIHwgc3RyaW5nW10sIGxpc3RlbmVyOiBFdmVudENhbGxiYWNrKTogUGF1c2FibGVIYW5kbGU7XG5leHBvcnQgZnVuY3Rpb24gcGF1c2FibGUodGFyZ2V0OiBhbnksIHR5cGU6IGFueSwgbGlzdGVuZXI6IGFueSwgY2FwdHVyZT86IGJvb2xlYW4pOiBQYXVzYWJsZUhhbmRsZSB7XG5cdGxldCBwYXVzZWQ6IGJvb2xlYW47XG5cblx0Y29uc3QgaGFuZGxlID0gPFBhdXNhYmxlSGFuZGxlPiBvbih0YXJnZXQsIHR5cGUsIGZ1bmN0aW9uICgpIHtcblx0XHRpZiAoIXBhdXNlZCkge1xuXHRcdFx0cmV0dXJuIGxpc3RlbmVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0fVxuXHR9LCBjYXB0dXJlKTtcblxuXHRoYW5kbGUucGF1c2UgPSBmdW5jdGlvbiAoKSB7XG5cdFx0cGF1c2VkID0gdHJ1ZTtcblx0fTtcblxuXHRoYW5kbGUucmVzdW1lID0gZnVuY3Rpb24gKCkge1xuXHRcdHBhdXNlZCA9IGZhbHNlO1xuXHR9O1xuXG5cdHJldHVybiBoYW5kbGU7XG59XG4iXX0=